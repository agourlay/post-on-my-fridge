// ==========================================================================
// Project:   Ember Touch - Touch and Gesture Library For Ember
// Copyright: ©2011-2012 Pepe Cano and contributors
//            Portions ©2006-2011 Strobe Inc.
// License:   Licensed under MIT license
//            See https://raw.github.com/emberjs-addons/ember-touch/master/LICENSE
// ==========================================================================
(function(){Em.TimeoutTouchEventType={Cancel:"cancel",End:"end"};Em.TimeoutTouchEvent=function(e){this.type=e.type}})();(function(){var e=Em.get;var t=Em.set;Em.TouchList=Em.Object.extend({touches:null,timestamp:null,init:function(){this._super();t(this,"touches",[])},addTouch:function(t){var n=e(this,"touches");n.push(t);this.notifyPropertyChange("touches")},updateTouch:function(t){var n=e(this,"touches");for(var r=0,i=n.length;r<i;r++){var s=n[r];if(s.identifier===t.identifier){n[r]=t;this.notifyPropertyChange("touches");break}}},removeAllTouches:function(){t(this,"touches",[])},touchWithId:function(t){var n=null,r=e(this,"touches");for(var i=0,s=r.length;i<s;i++){var o=r[i];if(o.identifier===t){n=o;break}}return n},length:Ember.computed(function(){var t=e(this,"touches");return t.length}).property("touches").cacheable()})})();(function(){})();(function(){var e=Em.get,t=Em.set;Em.ApplicationGestureManager=Em.Object.extend({_delegates:null,isAllBlocked:false,_gestures:null,_blockerView:null,_isBlocked:false,_shouldReceiveTouchFn:null,init:function(){this._super();this._gestures={};this._delegates={}},registerGesture:function(e,t){if(this._gestures[e]!==undefined){throw new Ember.Error(e+" already exists as a registered gesture recognizer. Gesture recognizers must have globally unique names.")}this._gestures[e]=t},unregisterGesture:function(e){if(this._gestures[e]){delete this._gestures[e]}},knownGestures:function(){return this._gestures||{}},registerDelegate:function(e){this._delegates[e.get("name")]=e},findDelegate:function(e){return this._delegates[e]},isBlocked:Ember.computed(function(){return this.get("_isBlocked")}).property("_isBlocked"),shouldReceiveTouch:function(e){return this.get("_shouldReceiveTouchFn")(e)},block:function(e,n){if(this.get("isBlocked")){throw new Error("manager has already blocked the gesture recognizer")}t(this,"_shouldReceiveTouchFn",n);t(this,"_isBlocked",true);t(this,"_blockerView",e)},unblock:function(e){if(!this.get("isBlocked")){throw new Error("unblock, the gesture recognizer when the recognizer was not blocked. Did you unblock after Start? ")}var t=this.get("_blockerView");if(e!==t){throw new Error("unblock a view which was not the one which blocked the gesture recognizer")}this.set("_isBlocked",false);this.set("_blockerView",null);this.set("_shouldReceiveTouchFn",null)}})})();(function(){Em.GestureDelegateRule=Em.Object.extend({shouldReceiveTouch:function(e,t,n){}})})();(function(){Em.GestureDelegate=Em.Object.extend({name:null,rules:null,init:function(){this._super();var e=this.rules,t=[],n;if(!!e){var r,i;for(r=0,i=e.length;r<i;r++){n=e[r];if(Em.typeOf(n)==="string"){n=Em.get(n)}if(!n.isInstance){n=n.create()}t.push(n)}}this.rules=t},shouldReceiveTouch:function(e,t,n){return true}})})();(function(){var e=Em.get;var t=Em.set;Em.GestureManager=Em.Object.extend({gestures:null,applicationGestureManager:Ember.computed(function(){return this.view.get("container").lookup("gesture:application")}),container:null,view:null,touchStart:function(e,t){return this._invokeEvent("touchStart",e)},touchMove:function(e,t){return this._invokeEvent("touchMove",e)},touchEnd:function(e,t){return this._invokeEvent("touchEnd",e)},touchCancel:function(e,t){return this._invokeEvent("touchCancel",e)},_invokeEvent:function(e,t){var n=this.get("gestures"),r=n.length,i,s=true;i=this.view[e];if(Em.typeOf(i)==="function"){i.call(this.view,t)}var o=this.get("applicationGestureManager");if(!o.get("isAllBlocked")){if(r>0){var u=o.get("isBlocked")?o.shouldReceiveTouch(this.view):true;if(u){var a,f,l,c;for(c=0;c<r;c++){a=n[c];i=a[e];if(Em.typeOf(i)==="function"){f=a.get("delegate");if(!a.get("isEnabled")){l=false}else if(!f){l=true}else{l=this._applyDelegateRules(f,a,this.view,t);if(l===undefined){l=f.shouldReceiveTouch(a,this.view,t)}}if(l){s=i.call(a,t)}}}}}var h=this.view.get("parentView");if(h){var p=h.get("eventManager");if(p){p._invokeEvent(e,t)}}}return s},_applyDelegateRules:function(e,t,n,r){var i=e.rules,s=i.length;if(s>0){var o,u;for(o=0;o<s;o++){u=i[o].shouldReceiveTouch(t,n,r);if(u!==undefined){return u}}}return undefined}})})();(function(){var e=Em.get,t=Em.set;Em.Gesture=Em.Object.extend({state:null,name:null,view:null,applicationGestureManager:Ember.computed(function(){return this.view.get("container").lookup("gesture:application")}),container:null,gestureIsDiscrete:false,simultaneously:true,delegateName:null,delegate:null,isEnabled:true,touches:null,numberOfActiveTouches:0,numberOfRequiredTouches:1,init:function(){this._super();this.touches=Em.TouchList.create();this.name=e(this,"name");var n=this.get("delegateName");var r=this.get("delegate");if(!r&&n){var i=e(this,"applicationGestureManager");r=i.findDelegate(n);Em.assert("empty delegate, attempting to set up delegate based on delegateName",r);t(this,"delegate",r)}},didBecomePossible:function(){},eventWasRejected:function(){},shouldBegin:function(){return true},didBegin:function(){},didChange:function(e){},shouldEnd:function(){return true},didEnd:function(){},didCancel:function(){},blockApplicationGestureManagerIfSimultaneously:function(){if(!this.simultaneously){var e=this.view;var t=function(t){return e===t};var n=this.get("applicationGestureManager");n.block.apply(n,[e,t])}},attemptGestureEventDelivery:function(e,t){Em.assert("attemptGestureEventDelivery is called with eventName and event arguments",!!e&&!!t);var n=this._notifyViewOfGestureEvent(e,t);if(!n){this.eventWasRejected()}},distance:function(e){if(e.length<2){return 0}var t=e[0];var n=e[1];var r=t.pageX;var i=t.pageY;var s=n.pageX;var o=n.pageY;return Math.sqrt((r-=s)*r+(i-=o)*i)},centerPointForTouches:function(e){var t=0,n=0;for(var r=0,i=e.length;r<i;r++){var s=e[r];t+=s.pageX;n+=s.pageY}var o={x:t/e.length,y:n/e.length};return o},_notifyViewOfGestureEvent:function(e,t){var n=this.view[e];var r=false;if(Em.typeOf(n)==="function"){r=n.call(this.view,this,t)}return r},toString:function(){return Em.Gesture+"<"+Em.guidFor(this)+">"},_resetState:function(){this.touches.removeAllTouches()},touchStart:function(n){var r=n.originalEvent.targetTouches;var i=this.touches;var s=e(this,"state");t(i,"timestamp",Date.now());for(var o=0,u=r.length;o<u;o++){var a=r[o];if(i.touchWithId(a.identifier)===null){if(i.get("length")===e(this,"numberOfRequiredTouches")){i.removeAllTouches()}i.addTouch(a)}}if(i.get("length")<e(this,"numberOfRequiredTouches")){t(this,"state",Em.Gesture.WAITING_FOR_TOUCHES)}else{if(this.gestureIsDiscrete){if(this.shouldBegin()){this.blockApplicationGestureManagerIfSimultaneously();t(this,"state",Em.Gesture.BEGAN);this.didBegin()}}else{t(this,"state",Em.Gesture.POSSIBLE);this.didBecomePossible()}}},touchMove:function(n){var r=e(this,"state");if(r===Em.Gesture.WAITING_FOR_TOUCHES||r===Em.Gesture.ENDED||r===Em.Gesture.CANCELLED){return}var i=n.originalEvent.changedTouches;var s=this.touches;t(s,"timestamp",Date.now());for(var o=0,u=i.length;o<u;o++){var a=i[o];s.updateTouch(a)}if(r===Em.Gesture.POSSIBLE&&!this.gestureIsDiscrete){if(this.shouldBegin()){this.blockApplicationGestureManagerIfSimultaneously();t(this,"state",Em.Gesture.BEGAN);this.didBegin();this.didChange(n);this.attemptGestureEventDelivery(this.name+"Start",n)}}else if(r===Em.Gesture.BEGAN||r===Em.Gesture.CHANGED){t(this,"state",Em.Gesture.CHANGED);this.didChange(n);if(!this.gestureIsDiscrete){this.attemptGestureEventDelivery(this.name+"Change",n)}}},touchEnd:function(n){var r=e(this,"state");var i=this.touches;t(i,"timestamp",Date.now());var s=n&&n.originalEvent?n.originalEvent.changedTouches:undefined;if(s){for(var o=0,u=s.length;o<u;o++){var a=s[o];i.updateTouch(a)}}if((r===Em.Gesture.BEGAN||r===Em.Gesture.CHANGED)&&this.shouldEnd()){t(this,"state",Em.Gesture.ENDED);this.didEnd();this.attemptGestureEventDelivery(this.name+"End",n)}this._resetState()},touchCancel:function(n){var r=e(this,"state");if(r!==Em.Gesture.CANCELLED){t(this,"state",Em.Gesture.CANCELLED);this.didCancel();if(!this.gestureIsDiscrete){this.attemptGestureEventDelivery(this.name+"Cancel",n)}}this._resetState()}});Em.GestureDirection={Vertical:1,Horizontal:2};Em.OneGestureDirection={Right:1,Left:2,Down:4,Up:8};Em.Gesture.WAITING_FOR_TOUCHES=0;Em.Gesture.POSSIBLE=1;Em.Gesture.BEGAN=2;Em.Gesture.CHANGED=3;Em.Gesture.ENDED=4;Em.Gesture.CANCELLED=5})();(function(){var e=Ember.set,t=Ember.get;Em.Application.reopen({gestureManager:Ember.computed(function(){return this.__container__.lookup("gesture:application")})});Ember.Application.initializer({name:"gestureManager",before:"defaultGestures",initialize:function(e){e.register("gesture:application",Ember.ApplicationGestureManager)}});Ember.Application.initializer({name:"defaultGestures",after:"gestureManager",initialize:function(e){var t=e.lookup("gesture:application");t.registerGesture("pan",Em.PanGestureRecognizer);t.registerGesture("pinch",Em.PinchGestureRecognizer);t.registerGesture("press",Em.PressGestureRecognizer);t.registerGesture("swipe",Em.SwipeGestureRecognizer);t.registerGesture("tap",Em.TapGestureRecognizer);t.registerGesture("touchHold",Em.TouchHoldGestureRecognizer)}})})();(function(){var e=Em.get,t=Em.set;Em.View.reopen({eventManager:null,init:function(){this._super();this._createGestureManager()},_createGestureManager:function(){var n=e(this,"eventManager");if(!n){var r=e(this,"container").lookup("gesture:application");var i=r.knownGestures();var s=[];var o=Em.GestureManager.create();Em.assert("You should register a gesture. Take a look at the registerGestures injection",!!i);for(var u in i){if(this[u+"Start"]||this[u+"Change"]||this[u+"End"]){var a;if(this[u+"Options"]!==undefined&&typeof this[u+"Options"]==="object"){a=this[u+"Options"]}else{a={}}a.name=u;a.view=this;a.manager=o;var f={};if(a.isEnabledBinding){if(!Ember.isGlobalPath(a.isEnabledBinding)){f.isEnabledBinding="view."+a.isEnabledBinding}else{f.isEnabledBinding=a.isEnabledBinding}a=Ember.$.extend({},a);delete a.isEnabledBinding}var l=i[u].create(a,f);if(f.isEnabledBinding){Ember.run.sync()}s.push(l)}}t(o,"view",this);t(o,"gestures",s);t(this,"eventManager",o)}}})})();(function(){})();(function(){var e=Em.get,t=Em.set;Em.PinchGestureRecognizer=Em.Gesture.extend({scale:1,numberOfRequiredTouches:2,_startingDistanceBetweenTouches:null,_previousTimestamp:null,_previousDistance:0,_deltaThreshold:5,_previousScale:1,didBecomePossible:function(){this._startingDistanceBetweenTouches=this.distance(e(this.touches,"touches"));this._previousDistance=this._startingDistanceBetweenTouches;this._previousTimestamp=e(this.touches,"timestamp")},shouldBegin:function(){var t=this.distance(e(this.touches,"touches"));return Math.abs(t-this._startingDistanceBetweenTouches)>=this._deltaThreshold},didChange:function(){var n=this._previousScale=e(this,"scale");var r=this.touches.timestamp-this._previousTimestamp;var i=this.distance(e(this.touches,"touches"));var s=i-this._previousDistance;t(this,"velocity",s/r);t(this,"scale",i/this._previousDistance);this._previousTimestamp=e(this.touches,"timestamp");this._previousDistance=i},eventWasRejected:function(){t(this,"scale",this._previousScale)}})})();(function(){var e=Em.get,t=Em.set;Em.PanGestureRecognizer=Em.Gesture.extend({translation:null,initThreshold:5,direction:Em.GestureDirection.Horizontal|Em.GestureDirection.Vertical,_previousLocation:null,_previousTranslation:null,init:function(){this._super();t(this,"translation",{x:0,y:0})},didBecomePossible:function(){this._previousLocation=this.centerPointForTouches(e(this.touches,"touches"))},shouldBegin:function(){var t=this._previousLocation;var n=this.centerPointForTouches(e(this.touches,"touches"));var r=t.x;var i=t.y;var s=n.x;var o=n.y;var u=false;if(this.direction&Em.GestureDirection.Vertical){u=Math.abs(i-o)>=this.initThreshold}if(!u&&this.direction&Em.GestureDirection.Horizontal){u=Math.abs(r-s)>=this.initThreshold}return u},didChange:function(){var n=this._previousLocation;var r=this.centerPointForTouches(e(this.touches,"touches"));var i={x:r.x,y:r.y};i.x=r.x-n.x;i.y=r.y-n.y;this._previousTranslation=e(this,"translation");t(this,"translation",i);this._previousLocation=r},eventWasRejected:function(){t(this,"translation",this._previousTranslation)},toString:function(){return Em.PanGestureRecognizer+"<"+Em.guidFor(this)+">"}})})();(function(){var e=Em.get,t=Em.set;Em.TapGestureRecognizer=Em.Gesture.extend({numberOfTaps:1,delayBetweenTaps:500,tapThreshold:10,gestureIsDiscrete:true,_initialLocation:null,_waitingTimeout:null,_waitingForMoreTouches:false,_internalTouches:null,init:function(){this._super();this._internalTouches=Em.TouchList.create();Em.assert(e(this,"numberOfRequiredTouches")===1,"TODO: implement!!")},shouldBegin:function(){return e(this.touches,"length")===e(this,"numberOfRequiredTouches")},didBegin:function(){this._initialLocation=this.centerPointForTouches(e(this.touches,"touches"));this._internalTouches.addTouch(this.touches[0]);this._waitingForMoreTouches=e(this._internalTouches,"length")<e(this,"numberOfTaps");if(this._waitingForMoreTouches){var t=this;this._waitingTimeout=window.setTimeout(function(){t._waitingFired(t)},this.delayBetweenTaps)}},shouldEnd:function(){var t=this.centerPointForTouches(e(this.touches,"touches"));var n=this._initialLocation.x;var r=this._initialLocation.y;var i=t.x;var s=t.y;var o=Math.sqrt((n-=i)*n+(r-=s)*r);return Math.abs(o)<this.tapThreshold&&!this._waitingForMoreTouches},didEnd:function(){window.clearTimeout(this._waitingTimeout);this._initialLocation=null;this._internalTouches.removeAllTouches()},_waitingFired:function(){this._initialLocation=null;this._internalTouches.removeAllTouches();t(this,"state",Em.Gesture.CANCELLED);var e=this.name+"Cancel";var n=new Em.TimeoutTouchEvent({type:Em.TimeoutTouchEventType.Cancel});this.attemptGestureEventDelivery(e,n);this._resetState()},toString:function(){return Em.TapGestureRecognizer+"<"+Em.guidFor(this)+">"}})})();(function(){var e=Em.get,t=Em.set;Em.PressGestureRecognizer=Em.Gesture.extend({pressPeriodThreshold:500,gestureIsDiscrete:true,_initialLocation:null,_moveThreshold:10,_initialTimestamp:null,shouldBegin:function(){return e(this.touches,"length")===e(this,"numberOfRequiredTouches")},didBegin:function(){this._initialLocation=this.centerPointForTouches(e(this.touches,"touches"));this._initialTimestamp=e(this.touches,"timestamp")},shouldEnd:function(){var n=this.centerPointForTouches(e(this.touches,"touches"));var r=this._initialLocation.x;var i=this._initialLocation.y;var s=n.x;var o=n.y;var u=Math.sqrt((r-=s)*r+(i-=o)*i);var a=Math.abs(u)<this._moveThreshold;var f=e(this.touches,"timestamp");var l=f-this._initialTimestamp>=this.pressPeriodThreshold;var c=a&&l;if(!c){t(this,"state",Em.Gesture.CANCELLED);this.didCancel()}return c},didEnd:function(){this._resetCounters()},didCancel:function(){this._resetCounters()},_resetCounters:function(){this._initialLocation=null;this._initialTimestamp=null},toString:function(){return Em.PressGestureRecognizer+"<"+Em.guidFor(this)+">"}})})();(function(){var e=Em.get,t=Em.set;Em.TouchHoldGestureRecognizer=Em.Gesture.extend({holdPeriod:2e3,moveThreshold:50,gestureIsDiscrete:true,_endTimeout:null,_targetElement:null,shouldBegin:function(){return e(this.touches,"length")===e(this,"numberOfRequiredTouches")},didBegin:function(){this._initialLocation=this.centerPointForTouches(e(this.touches,"touches"));var n=e(this.touches,"touches")[0].target;t(this,"_target",n);var r=this;this._endTimeout=window.setTimeout(function(){r._endFired(r)},this.holdPeriod)},didChange:function(){var n=this.centerPointForTouches(e(this.touches,"touches"));var r=this._initialLocation.x;var i=this._initialLocation.y;var s=n.x;var o=n.y;var u=Math.sqrt((r-=s)*r+(i-=o)*i);var a=Math.abs(u)<this.moveThreshold;if(!a){this._disableEndFired();t(this,"state",Em.Gesture.CANCELLED)}},shouldEnd:function(){this._disableEndFired();t(this,"state",Em.Gesture.CANCELLED);this.didCancel();return false},_endFired:function(){this._disableEndFired();if(this.state===Em.Gesture.BEGAN||this.state===Em.Gesture.CHANGED){t(this,"state",Em.Gesture.ENDED);var e=this.name+"End";var n=new Em.TimeoutTouchEvent({type:Em.TimeoutTouchEventType.End});this.attemptGestureEventDelivery(e,n)}},_disableEndFired:function(){window.clearTimeout(this._endTimeout)},toString:function(){return Em.TouchHoldGestureRecognizer+"<"+Em.guidFor(this)+">"}})})();(function(){var e=Em.get,t=Em.set;Em.SwipeGestureRecognizer=Em.Gesture.extend({cancelPeriod:100,swipeThreshold:50,initThreshold:5,direction:Em.OneGestureDirection.Right,numberOfRequiredTouches:1,swipeDirection:null,_initialLocation:null,_previousLocation:null,_cancelTimeout:null,didBecomePossible:function(){this._previousLocation=this.centerPointForTouches(e(this.touches,"touches"))},shouldBegin:function(){var t=this._previousLocation;var n=this.centerPointForTouches(e(this.touches,"touches"));var r=t.x;var i=t.y;var s=n.x;var o=n.y;var u=false;if(this.direction&Em.OneGestureDirection.Right){u=s-r>this.initThreshold}if(!u&&this.direction&Em.OneGestureDirection.Left){u=r-s>this.initThreshold}if(!u&&this.direction&Em.OneGestureDirection.Down){u=o-i>this.initThreshold}if(!u&&this.direction&Em.OneGestureDirection.Up){u=i-o>this.initThreshold}return u},didBegin:function(){this._initialLocation=this.centerPointForTouches(e(this.touches,"touches"));var t=this;this._cancelTimeout=window.setTimeout(function(){t._cancelFired(t)},this.cancelPeriod)},didChange:function(n){var r=this.centerPointForTouches(e(this.touches,"touches"));var i=this._initialLocation.x;var s=this._initialLocation.y;var o=r.x;var u=r.y;var a=false;if(this.direction&Em.OneGestureDirection.Right){a=o-i>this.swipeThreshold;this.swipeDirection=Em.OneGestureDirection.Right}if(!a&&this.direction&Em.OneGestureDirection.Left){a=i-o>this.swipeThreshold;this.swipeDirection=Em.OneGestureDirection.Left}if(!a&&this.direction&Em.OneGestureDirection.Down){a=u-s>this.swipeThreshold;this.swipeDirection=Em.OneGestureDirection.Down}if(!a&&this.direction&Em.OneGestureDirection.Up){a=s-u>this.swipeThreshold;this.swipeDirection=Em.OneGestureDirection.Up}if(a){this._disableCancelFired();t(this,"state",Em.Gesture.ENDED);var f=this.name+"End";this.attemptGestureEventDelivery(f,n);this._resetState()}},shouldEnd:function(){this._cancelFired();return false},_cancelFired:function(){this._disableCancelFired();t(this,"state",Em.Gesture.CANCELLED);var e=this.name+"Cancel";var n=new Em.TimeoutTouchEvent({type:Em.TimeoutTouchEventType.Cancel});this.attemptGestureEventDelivery(e,n);this._resetState()},_disableCancelFired:function(){window.clearTimeout(this._cancelTimeout)},toString:function(){return Em.SwipeGestureRecognizer+"<"+Em.guidFor(this)+">"}})})();(function(){})();(function(){})()